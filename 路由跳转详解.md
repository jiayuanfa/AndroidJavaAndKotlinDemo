# Navigation Compose è·¯ç”±è·³è½¬è¯¦è§£

## ğŸ“‹ ç›®å½•
1. [åŸºæœ¬æ¦‚å¿µ](#åŸºæœ¬æ¦‚å¿µ)
2. [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
3. [å®ç°æ­¥éª¤](#å®ç°æ­¥éª¤)
4. [ä½ çš„é¡¹ç›®ä¸­çš„å®ç°](#ä½ çš„é¡¹ç›®ä¸­çš„å®ç°)
5. [å®Œæ•´æµç¨‹](#å®Œæ•´æµç¨‹)
6. [é«˜çº§ç”¨æ³•](#é«˜çº§ç”¨æ³•)

---

## åŸºæœ¬æ¦‚å¿µ

### ä»€ä¹ˆæ˜¯è·¯ç”±è·³è½¬ï¼Ÿ

è·¯ç”±è·³è½¬å°±æ˜¯åœ¨ä¸åŒçš„å±å¹•ï¼ˆScreenï¼‰ä¹‹é—´åˆ‡æ¢ï¼Œç±»ä¼¼äºç½‘é¡µçš„é¡µé¢è·³è½¬ã€‚

**ä¼ ç»ŸAndroidï¼ˆXMLï¼‰ï¼š**
- ä½¿ç”¨Intentè·³è½¬åˆ°å¦ä¸€ä¸ªActivity
- éœ€è¦å®šä¹‰Activityï¼Œåœ¨AndroidManifest.xmlä¸­æ³¨å†Œ

**Jetpack Compose Navigationï¼š**
- ä½¿ç”¨å­—ç¬¦ä¸²æ ‡è¯†è·¯ç”±ï¼ˆrouteï¼‰
- ä¸éœ€è¦Activityï¼Œæ‰€æœ‰å±å¹•éƒ½æ˜¯Composableå‡½æ•°
- æ›´è½»é‡ã€æ›´çµæ´»

---

## æ ¸å¿ƒç»„ä»¶

### 1. NavControllerï¼ˆå¯¼èˆªæ§åˆ¶å™¨ï¼‰

**ä½œç”¨ï¼š** ç®¡ç†å¯¼èˆªçŠ¶æ€ï¼Œæ§åˆ¶é¡µé¢è·³è½¬

```kotlin
val navController = rememberNavController()
```

- `rememberNavController()`ï¼šåˆ›å»ºå¹¶è®°ä½NavControllerå®ä¾‹
- åœ¨æ•´ä¸ªå¯¼èˆªè¿‡ç¨‹ä¸­ä¿æŒåŒä¸€ä¸ªå®ä¾‹
- ç®¡ç†å¯¼èˆªæ ˆï¼ˆback stackï¼‰

### 2. NavHostï¼ˆå¯¼èˆªå®¿ä¸»ï¼‰

**ä½œç”¨ï¼š** å®šä¹‰æ‰€æœ‰å¯ç”¨çš„è·¯ç”±å’Œå¯¹åº”çš„å±å¹•

```kotlin
NavHost(
    navController = navController,
    startDestination = "home"  // èµ·å§‹è·¯ç”±
) {
    // å®šä¹‰è·¯ç”±
}
```

### 3. composableï¼ˆè·¯ç”±å®šä¹‰ï¼‰

**ä½œç”¨ï¼š** å®šä¹‰è·¯ç”±å’Œå¯¹åº”çš„å±å¹•

```kotlin
composable("route_name") {
    // å¯¹åº”çš„å±å¹•ç»„ä»¶
}
```

---

## å®ç°æ­¥éª¤

### æ­¥éª¤1ï¼šåˆ›å»ºNavController

```kotlin
@Composable
fun AppNavigation() {
    val navController = rememberNavController()
    // ...
}
```

### æ­¥éª¤2ï¼šåˆ›å»ºNavHostå¹¶å®šä¹‰è·¯ç”±

```kotlin
NavHost(
    navController = navController,
    startDestination = "home"
) {
    composable("home") {
        HomeScreen(...)
    }
    
    composable("kotlin") {
        KotlinModuleScreen(...)
    }
}
```

### æ­¥éª¤3ï¼šåœ¨å±å¹•ä¸­è°ƒç”¨å¯¼èˆª

```kotlin
// è·³è½¬åˆ°æŒ‡å®šè·¯ç”±
navController.navigate("kotlin")

// è¿”å›ä¸Šä¸€é¡µ
navController.popBackStack()
```

---

## ä½ çš„é¡¹ç›®ä¸­çš„å®ç°

### 1. å¯¼èˆªé…ç½®ï¼ˆAppNavigation.ktï¼‰

```kotlin
@Composable
fun AppNavigation(
    navController: NavHostController = rememberNavController()
) {
    NavHost(
        navController = navController,
        startDestination = "home"  // â† èµ·å§‹é¡µé¢
    ) {
        // å®šä¹‰è·¯ç”±1ï¼šé¦–é¡µ
        composable("home") {
            HomeScreen(
                onNavigateToKotlin = {
                    navController.navigate("kotlin")  // â† è·³è½¬åˆ°Kotlinæ¨¡å—
                },
                onNavigateToJava = {
                    navController.navigate("java")    // â† è·³è½¬åˆ°Javaæ¨¡å—
                }
                // ...
            )
        }
        
        // å®šä¹‰è·¯ç”±2ï¼šKotlinæ¨¡å—
        composable("kotlin") {
            KotlinModuleScreen(
                onNavigateBack = {
                    navController.popBackStack()  // â† è¿”å›ä¸Šä¸€é¡µ
                }
            )
        }
        
        // å…¶ä»–è·¯ç”±...
    }
}
```

### 2. é¦–é¡µï¼ˆHomeScreen.ktï¼‰

```kotlin
@Composable
fun HomeScreen(
    onNavigateToKotlin: () -> Unit,  // â† æ¥æ”¶å¯¼èˆªå‡½æ•°
    // ...
) {
    ModuleCard(
        title = "Kotlin",
        onClick = onNavigateToKotlin  // â† ç‚¹å‡»æ—¶è°ƒç”¨å¯¼èˆªå‡½æ•°
    )
}
```

### 3. æ¨¡å—é¡µé¢ï¼ˆKotlinModuleScreen.ktï¼‰

```kotlin
@Composable
fun KotlinModuleScreen(
    onNavigateBack: () -> Unit  // â† æ¥æ”¶è¿”å›å‡½æ•°
) {
    Scaffold(
        topBar = {
            TopAppBar(
                navigationIcon = {
                    IconButton(onClick = onNavigateBack) {  // â† ç‚¹å‡»è¿”å›
                        Icon(Icons.Default.ArrowBack, ...)
                    }
                }
            )
        }
    ) { ... }
}
```

---

## å®Œæ•´æµç¨‹

### ç¤ºä¾‹ï¼šä»é¦–é¡µè·³è½¬åˆ°Kotlinæ¨¡å—

```
1. ç”¨æˆ·ç‚¹å‡»"Kotlin"å¡ç‰‡
   â†“
2. ModuleCardçš„onClickè¢«è§¦å‘
   â†“
3. è°ƒç”¨onNavigateToKotlin()
   â†“
4. åœ¨AppNavigationä¸­ï¼ŒonNavigateToKotlin = { navController.navigate("kotlin") }
   â†“
5. navController.navigate("kotlin")æ‰§è¡Œ
   â†“
6. NavHostæŸ¥æ‰¾è·¯ç”±"kotlin"
   â†“
7. æ‰¾åˆ°composable("kotlin") { KotlinModuleScreen(...) }
   â†“
8. æ˜¾ç¤ºKotlinModuleScreen
   â†“
9. é¦–é¡µè¢«å‹å…¥å¯¼èˆªæ ˆï¼ˆback stackï¼‰
```

### è¿”å›æµç¨‹

```
1. ç”¨æˆ·ç‚¹å‡»è¿”å›æŒ‰é’®
   â†“
2. è°ƒç”¨onNavigateBack()
   â†“
3. åœ¨AppNavigationä¸­ï¼ŒonNavigateBack = { navController.popBackStack() }
   â†“
4. navController.popBackStack()æ‰§è¡Œ
   â†“
5. ä»å¯¼èˆªæ ˆå¼¹å‡ºå½“å‰é¡µé¢
   â†“
6. æ˜¾ç¤ºä¸Šä¸€ä¸ªé¡µé¢ï¼ˆé¦–é¡µï¼‰
```

---

## æ ¸å¿ƒAPIè¯´æ˜

### navigate(route: String)

**ä½œç”¨ï¼š** è·³è½¬åˆ°æŒ‡å®šè·¯ç”±

```kotlin
navController.navigate("kotlin")
```

**ç‰¹ç‚¹ï¼š**
- å°†å½“å‰é¡µé¢å‹å…¥å¯¼èˆªæ ˆ
- æ˜¾ç¤ºç›®æ ‡é¡µé¢
- æ”¯æŒå¤šæ¬¡è·³è½¬ï¼ˆå½¢æˆå¯¼èˆªæ ˆï¼‰

### popBackStack()

**ä½œç”¨ï¼š** è¿”å›ä¸Šä¸€é¡µ

```kotlin
navController.popBackStack()
```

**ç‰¹ç‚¹ï¼š**
- ä»å¯¼èˆªæ ˆå¼¹å‡ºå½“å‰é¡µé¢
- æ˜¾ç¤ºä¸Šä¸€ä¸ªé¡µé¢
- å¦‚æœæ ˆä¸ºç©ºï¼Œä»€ä¹ˆéƒ½ä¸åš

### popBackStack(route, inclusive)

**ä½œç”¨ï¼š** è¿”å›åˆ°æŒ‡å®šè·¯ç”±

```kotlin
navController.popBackStack("home", inclusive = false)
```

**å‚æ•°ï¼š**
- `route`ï¼šç›®æ ‡è·¯ç”±
- `inclusive`ï¼šæ˜¯å¦åŒ…å«ç›®æ ‡è·¯ç”±æœ¬èº«

---

## æ•°æ®ä¼ é€’

### æ–¹å¼1ï¼šé€šè¿‡è·¯ç”±å‚æ•°ï¼ˆæ¨èï¼‰

```kotlin
// å®šä¹‰å¸¦å‚æ•°çš„è·¯ç”±
composable("user/{userId}") { backStackEntry ->
    val userId = backStackEntry.arguments?.getString("userId")
    UserDetailScreen(userId = userId)
}

// è·³è½¬æ—¶ä¼ é€’å‚æ•°
navController.navigate("user/123")
```

### æ–¹å¼2ï¼šé€šè¿‡å¯é€‰å‚æ•°

```kotlin
composable(
    "user/{userId}?name={name}",
    arguments = listOf(
        navArgument("userId") { type = NavType.StringType },
        navArgument("name") { 
            type = NavType.StringType
            defaultValue = "Unknown"
        }
    )
) { backStackEntry ->
    val userId = backStackEntry.arguments?.getString("userId")
    val name = backStackEntry.arguments?.getString("name")
    UserDetailScreen(userId = userId, name = name)
}

// è·³è½¬
navController.navigate("user/123?name=John")
```

### æ–¹å¼3ï¼šé€šè¿‡NavTypeä¼ é€’å¤æ‚æ•°æ®

```kotlin
// ä¼ é€’å¯¹è±¡ï¼ˆéœ€è¦å®ç°Parcelableï¼‰
composable("detail/{user}") { backStackEntry ->
    val user = backStackEntry.arguments?.getParcelable<User>("user")
    DetailScreen(user = user)
}

// è·³è½¬
val user = User("John", 25)
navController.navigate("detail/$user")
```

---

## ä½ çš„é¡¹ç›®ä¸­çš„å®é™…ä¾‹å­

### å®Œæ•´çš„è·³è½¬æµç¨‹

```kotlin
// 1. AppNavigation.kt - å®šä¹‰è·¯ç”±
NavHost(
    navController = navController,
    startDestination = "home"
) {
    composable("home") {
        HomeScreen(
            // ä¼ é€’å¯¼èˆªå‡½æ•°ç»™HomeScreen
            onNavigateToKotlin = {
                navController.navigate("kotlin")  // â† è¿™é‡Œæ‰§è¡Œè·³è½¬
            }
        )
    }
    
    composable("kotlin") {
        KotlinModuleScreen(
            onNavigateBack = {
                navController.popBackStack()  // â† è¿™é‡Œæ‰§è¡Œè¿”å›
            }
        )
    }
}

// 2. HomeScreen.kt - ä½¿ç”¨å¯¼èˆªå‡½æ•°
@Composable
fun HomeScreen(
    onNavigateToKotlin: () -> Unit  // â† æ¥æ”¶å‡½æ•°
) {
    ModuleCard(
        onClick = onNavigateToKotlin  // â† ç‚¹å‡»æ—¶è°ƒç”¨
    )
}

// 3. KotlinModuleScreen.kt - è¿”å›
@Composable
fun KotlinModuleScreen(
    onNavigateBack: () -> Unit  // â† æ¥æ”¶è¿”å›å‡½æ•°
) {
    IconButton(onClick = onNavigateBack) {  // â† ç‚¹å‡»è¿”å›
        Icon(Icons.Default.ArrowBack, ...)
    }
}
```

---

## å¯¼èˆªæ ˆï¼ˆBack Stackï¼‰

### æ¦‚å¿µ

å¯¼èˆªæ ˆå°±åƒä¸€ä¸ªæ ˆï¼ˆStackï¼‰æ•°æ®ç»“æ„ï¼š
- **å‹æ ˆï¼ˆpushï¼‰**ï¼šè·³è½¬åˆ°æ–°é¡µé¢æ—¶ï¼Œå½“å‰é¡µé¢è¢«å‹å…¥æ ˆ
- **å¼¹æ ˆï¼ˆpopï¼‰**ï¼šè¿”å›æ—¶ï¼Œä»æ ˆé¡¶å¼¹å‡ºé¡µé¢

### ç¤ºä¾‹

```
åˆå§‹çŠ¶æ€ï¼š
æ ˆï¼š[home]

ç‚¹å‡»KotlinæŒ‰é’®ï¼š
æ ˆï¼š[home, kotlin]  â† kotlinåœ¨æ ˆé¡¶

ç‚¹å‡»è¿”å›ï¼š
æ ˆï¼š[home]  â† kotlinè¢«å¼¹å‡º

ç‚¹å‡»JavaæŒ‰é’®ï¼š
æ ˆï¼š[home, java]

ç‚¹å‡»è¿”å›ï¼š
æ ˆï¼š[home]
```

### å¯¼èˆªæ ˆçš„ä½œç”¨

1. **æ”¯æŒè¿”å›é”®**ï¼šç³»ç»Ÿè¿”å›é”®ä¼šè‡ªåŠ¨è°ƒç”¨`popBackStack()`
2. **ä¿æŒé¡µé¢çŠ¶æ€**ï¼šé¡µé¢åœ¨æ ˆä¸­æ—¶ï¼ŒçŠ¶æ€ä¼šè¢«ä¿æŒ
3. **æ”¯æŒæ·±å±‚å¯¼èˆª**ï¼šå¯ä»¥è·³è½¬å¤šå±‚ï¼Œç„¶åé€å±‚è¿”å›

---

## é«˜çº§ç”¨æ³•

### 1. é˜²æ­¢é‡å¤è·³è½¬

```kotlin
// å¦‚æœå·²ç»åœ¨ç›®æ ‡é¡µé¢ï¼Œä¸æ‰§è¡Œè·³è½¬
if (navController.currentDestination?.route != "kotlin") {
    navController.navigate("kotlin")
}
```

### 2. æ¸…é™¤å¯¼èˆªæ ˆ

```kotlin
// è·³è½¬å¹¶æ¸…é™¤æ‰€æœ‰ä¹‹å‰çš„é¡µé¢
navController.navigate("kotlin") {
    popUpTo("home") { inclusive = true }
}
```

### 3. å•ä¾‹å¯¼èˆªï¼ˆSingle Topï¼‰

```kotlin
// å¦‚æœç›®æ ‡é¡µé¢å·²åœ¨æ ˆä¸­ï¼Œä¸åˆ›å»ºæ–°å®ä¾‹
navController.navigate("kotlin") {
    launchSingleTop = true
}
```

### 4. åŠ¨ç”»è¿‡æ¸¡

```kotlin
composable(
    "kotlin",
    enterTransition = {
        slideInHorizontally(
            initialOffsetX = { fullWidth -> fullWidth },
            animationSpec = tween(300)
        )
    },
    exitTransition = {
        slideOutHorizontally(
            targetOffsetX = { fullWidth -> -fullWidth },
            animationSpec = tween(300)
        )
    }
) { ... }
```

---

## æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **NavController**ï¼šç®¡ç†å¯¼èˆªçŠ¶æ€
2. **NavHost**ï¼šå®šä¹‰æ‰€æœ‰è·¯ç”±
3. **composable**ï¼šå®šä¹‰è·¯ç”±å’Œå±å¹•çš„æ˜ å°„
4. **navigate()**ï¼šæ‰§è¡Œè·³è½¬
5. **popBackStack()**ï¼šè¿”å›ä¸Šä¸€é¡µ

### ä½ çš„é¡¹ç›®ä¸­çš„è·¯ç”±

```
home (èµ·å§‹é¡µ)
  â”œâ”€ users (ç”¨æˆ·åˆ—è¡¨)
  â”œâ”€ kotlin (Kotlinæ¨¡å—)
  â”œâ”€ java (Javaæ¨¡å—)
  â”œâ”€ android (Androidæ¨¡å—)
  â””â”€ framework (Frameworkæ¨¡å—)
```

### è®¾è®¡æ¨¡å¼

ä½¿ç”¨**å‡½æ•°å¼å‚æ•°**ä¼ é€’å¯¼èˆªå‡½æ•°ï¼š
- å±å¹•ç»„ä»¶ä¸ç›´æ¥ä¾èµ–NavController
- é€šè¿‡å‡½æ•°å‚æ•°ä¼ é€’å¯¼èˆªé€»è¾‘
- æé«˜å¯æµ‹è¯•æ€§å’Œè§£è€¦

---

## å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆä½¿ç”¨å‡½æ•°å‚æ•°è€Œä¸æ˜¯ç›´æ¥ä¼ é€’NavControllerï¼Ÿ

**A:** 
- è§£è€¦ï¼šå±å¹•ç»„ä»¶ä¸éœ€è¦çŸ¥é“NavController
- å¯æµ‹è¯•ï¼šå¯ä»¥ä¼ å…¥Mockå‡½æ•°è¿›è¡Œæµ‹è¯•
- çµæ´»æ€§ï¼šå¯ä»¥è‡ªå®šä¹‰å¯¼èˆªé€»è¾‘

### Q: å¦‚ä½•ä¼ é€’æ•°æ®ï¼Ÿ

**A:** 
- ç®€å•æ•°æ®ï¼šé€šè¿‡è·¯ç”±å‚æ•° `"user/{id}"`
- å¤æ‚æ•°æ®ï¼šé€šè¿‡NavTypeæˆ–å…±äº«ViewModel

### Q: å¦‚ä½•ç›‘å¬å¯¼èˆªäº‹ä»¶ï¼Ÿ

**A:** 
```kotlin
LaunchedEffect(navController) {
    navController.currentBackStackEntryFlow.collect { entry ->
        // å¤„ç†å¯¼èˆªäº‹ä»¶
    }
}
```

---

